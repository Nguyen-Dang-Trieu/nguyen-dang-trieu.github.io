---
title: File Hex (Part 1)
date: 2024-12-28
categories: [Computer, Compile]
tags: ['ASM']
author: Trieu
image:
  path: assets/headers/2024-12-28-hex-code.png
  alt: Hex Code
---
## ğŸŒ± Lá»i má»Ÿ Ä‘áº§u
ÄÃ¢y lÃ  bÃ i viáº¿t Ä‘áº§u tiÃªn trÃªn blog cá»§a tÃ´i ğŸ˜, vÃ  tÃ´i muá»‘n dÃ nh nÃ³ Ä‘á»ƒ giáº£i thÃ­ch chi tiáº¿t vá» file Hex â€“ má»™t khÃ¡i niá»‡m quan trá»ng trong tháº¿ giá»›i láº­p trÃ¬nh vÃ  há»‡ thá»‘ng nhÃºng.

***Táº¡i sao tÃ´i chá»n chá»§ Ä‘á» nÃ y Ä‘á»ƒ báº¯t Ä‘áº§u?***

Bá»Ÿi vÃ¬ tÃ´i tin ráº±ng **file Hex** lÃ  "ngÃ´n ngá»¯ chung" giÃºp mÃ¡y tÃ­nh, vi Ä‘iá»u khiá»ƒn, vÃ  vi xá»­ lÃ½ thá»±c thi cÃ¡c lá»‡nh mÃ  chÃºng ta láº­p trÃ¬nh. DÃ¹ báº¡n sá»­ dá»¥ng Python, Java, C/C++, Assembly, ... thÃ¬ sau khi qua trÃ¬nh biÃªn dá»‹ch, táº¥t cáº£ Ä‘á»u Ä‘Æ°á»£c chuyá»ƒn hÃ³a thÃ nh cÃ¡c con sá»‘ nhá»‹ phÃ¢n 0 vÃ  1. ÄÃ¢y chÃ­nh lÃ  "**nguyÃªn liá»‡u cÆ¡ báº£n**" Ä‘á»ƒ mÃ¡y mÃ³c cÃ³ thá»ƒ hiá»ƒu vÃ  hoáº¡t Ä‘á»™ng.

## I. File hex lÃ  gÃ¬
\- CÃ¡c file cÃ³ Ä‘uÃ´i <kbd>*.hex</kbd> Ä‘Æ°á»£c gá»i lÃ  file HEX. Hex lÃ  1 tiÃªu chuáº©n do Intel quy Ä‘á»‹nh. TÃªn Ä‘áº§y Ä‘á»§ cá»§a hex lÃ  Interl HEX. Loáº¡i file nÃ y thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truyá»n cÃ¡c chÆ°Æ¡ng trÃ¬nh vÃ  dá»¯ 
liá»‡u sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong ROM hoáº·c EEPROM. NÃ³ lÃ  má»™t file vÄƒn báº£n ASCII (2 kÃ­ tá»± mÃ£ ASCII biá»ƒu thá»‹ 1 byte Hex) bao gá»“m cÃ¡c dÃ²ng vÄƒn báº£n phÃ¹ há»£p vá»›i Ä‘á»‹nh dáº¡ng file Intel HEX.

\- File nÃ y chá»§ yáº¿u Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u firmware.

## II. Äinh dáº¡ng file Hex
DÆ°á»›i Ä‘Ã¢y lÃ  hÃ¬nh áº£nh minh há»a vá» 1 file.hex

![Hex Code](/assets/articles/2024/HexFile/2024-12-28-example.png){: .normal }
_Example Hex Code_

Má»—i dÃ²ng sáº½ tuÃ¢n theo **Format** sau

![Format Code](/assets/articles/2024/HexFile/2024-12-28-FormatCode.png){: .normal }
_Format Code_

- `Start code`: má»—i dÃ²ng Ä‘Æ°á»£c coi lÃ  1 frame, vÃ  Ä‘Æ°á»£c báº¯t Ä‘áº§u báº±ng dáº¥u hai cháº¥m " : ".
- `Byte count`: Hai chá»¯ sá»‘ tháº­p lá»¥c phÃ¢n cho biáº¿t sá»‘ byte trong Data. Sá»‘ byte tá»‘i Ä‘a lÃ  `255 (0xFF)`, `16 (0x10)` vÃ  `32 (0x20)` lÃ  cÃ¡c byte thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng.
- `Address`: Bá»‘n chá»¯ sá»‘ tháº­p lá»¥c phÃ¢n cho biáº¿t Ä‘á»™ lá»‡ch (offset) Ä‘á»‹a chá»‰. Äá»‹a chá»‰ váº­t lÃ­ cá»§a dá»¯ liá»‡u Ä‘Æ°á»£c tÃ­nh báº±ng cÃ¡ch thÃªm pháº§n offset nÃ y vÃ o Ä‘á»‹a chá»‰ cÆ¡ sá»Ÿ.
- `Record type`: Hai chá»¯ sá»‘ tháº­p lá»¥c phÃ¢n tá»« 0x00 -> 0x05.

| Command | Description |
| --- | --- |
| 0x00 | Data record | |
| 0x01 | End of File Record | 
| 0x02 | Extended Segment Address Record | 
| 0x03 | Start Segment Address Record | 
| 0x04 | Extended Linear Address Record |
| 0x05 | Start Linear Address Record |

- `Data`: chuá»—i dá»¯ liá»‡u n-byte.
- `Checksum`: Hai chá»¯ sá»‘ tháº­p lá»¥c phÃ¢n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c minh ráº±ng giÃ¡ trá»‹ tÃ­nh toÃ¡n Ä‘Æ°á»£c ghi khÃ´ng cÃ³ lá»—i.

**Example 1**: `:10000000A8990020C1010408830B040839080408DA`.

![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-Example1.png){: .normal }

- `:`: Báº¯t Ä‘áº§u.
- `0x10`: Sá»‘ byte data = 16.
- `0x00`, `0x00`: Äá»‹a chá»‰ offset nÆ¡i Ä‘á»ƒ lÆ°u dá»¯ liá»‡u. (Ta cÃ³ thá»ƒ hiá»ƒu lÃ  `0x0000`)
- `0x00`: Kiá»ƒu dá»¯ liá»‡u.
- `0xA8` , `0x99`, `0x00`, `0x20`, `0xC1`, `0x01`, `0x04`, `0x08`, `0x83`, `0x0B`, `0x04`, `0x08`, `0x39`, `0x08`, `0x04`, `0x08`: Data (Tá»•ng cá»™ng cÃ³ 16 bytes).
- Byte Checksum = `0xDA`.
  
Äá»ƒ cÃ³ thá»ƒ kiá»ƒm tra lá»—i trong frame thÃ¬: 
  - B1: Tá»•ng giÃ¡ trá»‹ cÃ¡c byte cÃ³ trong frame = `0x10` + `0x00` + `0x00` + `0x00` + `0xA8` + ... + `0x04` + `0x08` = `0x326`
  - B2: Láº¥y byte cuá»‘i cÃ¹ng = `0x26`. 
  - B3: Tá»•ng checksum = (`0x100` - byte cuá»‘i) & `0xFF` = (`0x100` - `0x26`) & `0xFF` = `0xDA` -> Ta tháº¥y Ä‘Æ°á»£c á»Ÿ cuá»‘i frame cÅ©ng lÃ  `0xDA` nÃªn frame nÃ y khÃ´ng cÃ³ `ERROR`.
    
**Example 2**: `:00000001FF`. 

ÄÃ¢y lÃ  dÃ²ng cuá»‘i cÃ¹ng trong hÃ¬nh áº£nh bÃªn trÃªn.
- `:`: Báº¯t Ä‘áº§u.
- `0x00`: Sá»‘ byte data = 0.
- `0x00`, `0x00`: Äá»‹a chá»‰ offset nÆ¡i Ä‘á»ƒ lÆ°u dá»¯ liá»‡u.
- `0x01`: End of File Record --> Káº¿t thÃºc file HEX.
- Data: `None`
- Byte Checksum = `0xFF`

## III. Sá»± khÃ¡c biá»‡t giá»¯a File.hex vÃ  File.bin
### 1. CÃ¡ch sá»­ dá»¥ng
- File `*.hex`: Khi láº­p trÃ¬nh vÃ  táº£i xuá»‘ng file Hex, ngÆ°á»i dÃ¹ng khÃ´ng cáº§n pháº£i chá»‰ Ä‘á»‹nh Ä‘á»‹a chá»‰ vÃ¬ thÃ´ng tin bÃªn trong File Hex Ä‘Ã£ bao gá»“m Ä‘á»‹a chá»‰.
- File `*.bin`: Khi ghi file BIN, ngÆ°á»i dÃ¹ng cáº§n pháº£i chá»‰ Ä‘á»‹nh Ä‘á»‹a chá»‰ do File Bin chá»‰ cÃ³ pháº§n `DATA` trong file HEX.
![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-HexBin.png){: .normal }

> TrÃ¡i lÃ  File.hex - Pháº£i lÃ  File.bin.
{: .prompt-warning }

### 2. KÃ­ch thÆ°á»›c File
NhÆ° Ä‘áº§u bÃ i viáº¿t tÃ´i cÃ³ Ä‘á» cáº­p: *File.hex lÃ  má»™t file vÄƒn báº£n ASCII*. Má»—i kÃ­ tá»± trong file Hex sáº½ cÃ³ kÃ­ch thÆ°á»›c lÃ  1 byte.

=> **File Hex** Ã­t nháº¥t pháº£i cÃ³ kÃ­ch thÆ°á»›c lá»›n hÆ¡n gáº¥p Ä‘Ã´i so vá»›i **File Bin**.

Äá»ƒ dá»… hiá»ƒu hÆ¡n thÃ¬ tÃ´i sáº½ láº¥y vÃ­ dá»¥ tá»« hÃ¬nh so sÃ¡nh bÃªn trÃªn.
- `46`: Trong file Hex sáº½ bao gá»“m 2 kÃ­ tá»± lÃ  `4` vÃ  `6`. Tra báº£ng mÃ£ ASCII ta Ä‘Æ°á»£c: `0x34` vÃ  `0x36` => Cáº§n `2 bytes` Ä‘á»ƒ biá»ƒu diá»…n `0x46`.
- `46`: Trong file Bin thÃ¬ chá»‰ cáº§n `1 byte` = `0x46`.
  
**Suy ra**: 
  - *File Hex* cÃ³ 10 bytes data thÃ¬ pháº£i dÃ¹ng Ã­t nháº¥t `20 byte` (chÆ°a ká»ƒ cÃ¡c bytes Ä‘á»ƒ mÃ´ táº£ `Address`, `Byte count`, ...) Ä‘á»ƒ biá»ƒu diá»…n.
  - *File Bin* thÃ¬ cÅ©ng chá»‰ cáº§n `10 byte` lÃ  Ä‘á»§.
## âœï¸ Practice
![ASM 8085](/assets/articles/2024/HexFile/2024-12-29-Practice.png){: .normal }
_Assembly of 8085_

ChÆ°Æ¡ng trÃ¬nh trÃªn dÃ¹ng Ä‘á»ƒ cá»™ng 2 sá»‘:
- `8101H`: chá»©a giÃ¡ trá»‹ `05H` cá»§a sá»‘ Ä‘áº§u tiÃªn.
- `8102H`: chá»©a giÃ¡ trá»‹ `03H` cá»§a sá»‘ thá»© hai.

**Giáº£i thÃ­ch asm**:
- `LXI H,8101`: náº¡p giÃ¡ trá»‹ `8101H` (16-bit) vÃ o cáº·p thanh ghi H chá»©a `81H` (bit cao) vÃ  thanh ghi L chá»©a `01H` (bit tháº¥p). Thanh ghi HL Ä‘ang trá» tá»›i Ä‘á»‹a chá»‰ `8101H` lÃ  nÆ¡i chá»©a giÃ¡ trá»‹ cá»§a sá»‘ Ä‘áº§u tiÃªn.
- `MOV A, M`: dÃ¹ng Ä‘á»ƒ di chuyá»ƒn giÃ¡ trá»‹ cá»§a Ã´ nhá»› táº¡i Ä‘á»‹a chá»‰ mÃ  thanh ghi HL Ä‘ang trá» tá»›i `8101H` vÃ o thanh ghi A -> Thanh ghi A hiá»‡n táº¡i cÃ³ giÃ¡ trá»‹ = `05H`.
- `LNX H`: tÄƒng giÃ¡ trá»‹ thanh ghi HL lÃªn 1 => Vá»‹ trÃ­ tiáº¿p theo mÃ  thanh ghi HL trá» tá»›i lÃ  `8102H` nÆ¡i chá»©a giÃ¡ trá»‹ `03H` cá»§a sá»‘ thá»© 2.
- `ADD M`: cá»™ng giÃ¡ trá»‹ táº¡i vÃ­ trÃ­ thanh ghi HL Ä‘ang trá» tá»›i `8102H` lÃ  `03H` vá»›i giÃ¡ trá»‹ Ä‘Ã£ cÃ³ sáºµn trong thanh ghi A `05H` => GiÃ¡ trá»‹ cuá»‘i cÃ¹ng `08H` Ä‘Æ°á»£c lÆ°u trong thanh ghi A.
- `STA 8103`: lÆ°u ná»™i dung cá»§a thanh ghi A vÃ o Ä‘á»‹a chá»‰ `8103H`. ÄÃ¢y lÃ  nÆ¡i lÆ°u trá»¯ giÃ¡ trá»‹ `08H` káº¿t quáº£ cá»§a phÃ©p cá»™ng 2 sá»‘ `03H` vÃ  `05H`.
- `RST 3`: nháº£y Ä‘áº¿n dá»‹a chá»‰ vector ngáº¯t Ä‘á»ƒ thá»±c hiá»‡n chÆ°Æ¡ng trÃ¬nh con or káº¿t thÃºc.   

Nhá»¯ng cÃ¢u lá»‡nh `ASM` trÃªn thÃ¬ cho con ngÆ°á»i hiá»ƒu nhÆ°ng Ä‘á»ƒ **CPU** hiá»ƒu thÃ¬ cáº§n pháº£i chuyá»ƒn `ASM` sang `HEX`. Äá»ƒ thá»±c hiá»‡n viá»‡c nÃ y ta dÃ¹ng `Assembler`. VÃ  **Assembler** sáº½ dá»±a vÃ o `OPCODE` Ä‘á»ƒ cÃ³ thá»ƒ chuyá»ƒn tá»« **file.asm** sang **file.hex** or **file.bin**. (*Tham kháº£o Opcode table cá»§a 8085*)
- `LXI H,8101` -> Hex Code: `21, 81, 01`
    - `LXI` cÃ³ opcode: `21H`
    - `81, 01`: giÃ¡ trá»‹ cá»§a lá»‡nh OPCODE nÃ y
- `MOV A, M` -> Hex Code: `7E`
    - `MOV` cÃ³ opcode: `7E`.
      
Opcode cá»§a cÃ¡c lá»‡nh cÃ²n láº¡i báº¡n tá»± tÃ¬m hiá»ƒu.

![OPCODE table of 8085](/assets/articles/2024/HexFile/2024-12-29-OpcodeTable.png){: .normal }
_Opcode Table of 8085_

## IV. LÆ°u trá»¯ data trong Memory
á» cÃ¡c má»¥c trÆ°á»›c ta Ä‘Ã£ hiá»ƒu Ä‘Æ°á»£c cÃ¡ch nÃ o file `*.hex` Ä‘Æ°á»£c táº¡o ra vÃ  tÃ¡c dá»¥ng cá»§a nÃ³. NhÆ°ng ta cÃ³ tháº¯c máº¯c ğŸ¤” file.hex Ä‘Ã³ sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ nhÆ° tháº¿ nÃ o trong bá»™ nhá»›.
> **File.hex Ä‘Æ°á»£c lÆ°u nhÆ° tháº¿ nÃ o trong memory ?**
{: .prompt-question }

TrÆ°á»›c tiÃªn hÃ£y nhÃ¬n vÃ o hÃ¬nh áº£nh sau Ä‘Ã¢y, trong vÃ­ dá»¥ nÃ y tÃ´i dÃ¹ng bá»™ nhá»› cÃ³ `32-bits` address --> CÃ³ tá»•ng cá»™ng 4GB Ä‘á»ƒ cÃ³ thá»ƒ lÆ°u trá»¯.
![Memory of 32-bits Address](/assets/articles/2024/HexFile/2024-12-29-Address.png){: .normal }
_Memory_

Má»—i Ã´ nhá»› (8-bit) sáº½ cÃ³ 1 Ä‘á»‹a chá»‰ (32-bit) tÆ°Æ¡ng á»©ng. GiÃ¡ trá»‹ cá»§a má»—i Ã´ nhá»› nÃ y lÃ  pháº§n `DATA` trong File.hex. (*Má»—i Ã´ nhá»› = 8-bit Ä‘á»u Ä‘Ãºng trong address 8-bit, 16-bit, 64-bit*)

**Example:**
- `0x0000 0000`: chá»©a giÃ¡ trá»‹ `0100 1111`.
- `0x0000 0003`: chá»©a giÃ¡ trá»‹ `0110 1011`.
- `0x0000 0008`: chá»©a giÃ¡ trá»‹ `0100 1001`.

**Example**: Láº¥y hÃ¬nh áº£nh tá»« pháº§n trÆ°á»›c, á»Ÿ Ä‘Ã¢y chá»‰ xÃ©t 3 dÃ²ng Ä‘áº§u.
![](/assets/articles/2024/HexFile/2024-12-29-ExampleAddress.png){: .normal }

\- DÃ²ng 1: Quyáº¿t Ä‘á»‹nh Ä‘á»‹a chá»‰ cÆ¡ sá»Ÿ bÄƒt Ä‘áº§u Ä‘á»ƒ lÆ°u trá»¯ data. Pháº§n **DATA** = `6000` nghÄ©a lÃ  `0x6000` (16-bits cao trong 32-bits Ä‘á»‹a chá»‰).

\- DÃ²ng 2:
  - 16-bits tháº¥p: `0x0000` => Äá»‹a chá»‰ chÃ­nh xÃ¡c mÃ  **DATA** báº¯t Ä‘áº§u Ä‘Æ°á»£c lÆ°u trá»¯ lÃ : `0x6000 0000`.
  - Data gá»“m 16 bytes: `0x46`, `0x43`, `0x46`, `0x42`, `0x00`, `0x04`, `0x01`, `0x56`, `0x00`, `0x00`, `0x00`, `0x00`, `0x01`, `0x03`, `0x03`, `0x00`.
    
\- DÃ²ng 3:
  - 16-bits tháº¥p: `0x0010` => Äá»‹a chá»‰ lÆ°u trá»¯ **DATA** tiáº¿p theo: `0x6000 0010`.
  - Data gá»“m 16 bytes: `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`, `0x00`.

![](/assets/articles/2024/HexFile/2024-12-29-DetailAddress.png){: .normal }

Hi vá»ng qua hÃ¬nh áº£nh nÃ y cÃ³ thá»ƒ giáº£i thÃ­ch rÃµ hÆ¡n.

## ğŸ‚ Lá»i káº¿t
\-Qua bÃ i viáº¿t nÃ y, tÃ´i hy vá»ng báº¡n sáº½ hiá»ƒu Ä‘Æ°á»£c toÃ n bá»™ nhá»¯ng ná»™i dung mÃ  tÃ´i muá»‘n truyá»n Ä‘áº¡t. Náº¿u cÃ³ báº¥t ká»³ tháº¯c máº¯c nÃ o, Ä‘á»«ng ngáº§n ngáº¡i Ä‘á»ƒ láº¡i bÃ¬nh luáº­n bÃªn dÆ°á»›i, tÃ´i luÃ´n sáºµn sÃ ng giáº£i Ä‘Ã¡p.

\-Trong tÆ°Æ¡ng lai, tÃ´i sáº½ tiáº¿p tá»¥c giáº£i thÃ­ch chi tiáº¿t cÃ¡c khÃ¡i niá»‡m Ä‘Æ°á»£c Ä‘á» cáº­p trong bÃ i, cháº³ng háº¡n nhÆ° OPCODE, CPU, trÃ¬nh biÃªn dá»‹ch (compiler), ... vÃ  nhiá»u ná»™i dung thÃº vá»‹ khÃ¡c.

\-Pháº§n tiáº¿p theo cá»§a bÃ i viáº¿t: [Part 2](https://nguyen-dang-trieu.github.io/posts/FileHexPart2/)

## ğŸŒ Reference
- https://scienceprog.com/shelling-the-intel-8-bit-hex-file-format/
- [Opcode 8085](https://fr.scribd.com/document/92351358/8085-OPCODES)
- https://programmedlessons.org/AssemblyTutorial/Chapter-04/ass04_05.html
